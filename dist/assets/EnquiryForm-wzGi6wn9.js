import{W as P,r as m,j as e,bg as T,B as c,q as w,n as j,af as E,V as s,M as n,ad as C,w as S,ar as O,as as R,ac as F,ae as f,aY as B,L as M,F as A,H as v,J as l,K as L,bn as U}from"./index-DGO-Ln70.js";const Q=()=>{var b;const d=(b=P().state)==null?void 0:b.enquiryDetails,p=!!d,[q,N]=m.useState("existing"),[g,h]=m.useState([]),[y,x]=m.useState([]),[t,_]=m.useState({marketingBy:"",type:"",source:"",enquiryNo:"",date:"",customerCategory:"",customerCode:"",customerName:"",address:"",address1:"",cityName:"",pincode:"",country:"",state:"",telephone:"",email:"",industryType:"",designation:"",refDocDate:"",contactPerson:"",remark:"",customerPartNo:"",itemCode:"",itemName:"",quantity:"",uom:"",application:"",technicalFeasibility:""}),i=a=>{const{name:o,value:r}=a.target;_(u=>({...u,[o]:r}))},D=()=>{h(g.filter(a=>!y.includes(a.id))),x([])},z=()=>{if(!t.itemCode||!t.quantity){alert("Item Code and Quantity required");return}h(a=>[...a,{id:Date.now(),customerPartNo:t.customerPartNo,itemCode:t.itemCode,itemName:t.itemName,quantity:t.quantity,uom:t.uom,selected:!1}]),_(a=>({...a,customerPartNo:"",itemCode:"",itemName:"",quantity:"",uom:""}))},I=a=>{x(o=>o.includes(a)?o.filter(r=>r!==a):[...o,a])},k=async()=>{const a=localStorage.getItem("selectedDivision")||"",o={enquiry_hed_ex:{enq_no:t.enquiryNo,enq_dt:t.date||new Date().toISOString(),cust_code:t.customerCode,cust_name:t.customerName,cust_add1:t.address,cust_add2:t.address1,cust_city:t.cityName,cust_state:t.state,cust_country:t.country,cust_pin:t.pincode,fax:"string",phone:t.telephone,email:t.email,ref_no:"string",ref_dt:t.refDocDate||new Date().toISOString(),emp_name:t.marketingBy,enq_type:t.type,cont_per:t.contactPerson,cont_des:t.designation,enq_close:"s",product_position:"string",business_type:"string",cust_spec:"string",pack_dtl:"string",agency_certi:"s",tooling_costby:"string",remarks:t.remark,std:"string",prod_spec:"string",profcen_cd:a,user_name:"string",userdate:new Date().toISOString(),trng_flg:"st",source_name:t.source,industry_name:t.industryType},list_Enquiry_det_ex:g.map((r,u)=>({enq_no:t.enquiryNo,enq_dt:t.date||new Date().toISOString(),item_name:r.itemName,item_Code:r.itemCode,cust_item_code:r.customerPartNo,drg_no:"string",drg_Rev_no:"strin",final_process:"string",quantity:Number(r.quantity)||0,physibility:r.technicalFeasibility||"s",costing_dt:new Date().toISOString(),costing_no:"string",quot_dt:new Date().toISOString(),quot_no:"string",po_dt:new Date().toISOString(),po_no:"string",sample_dt:new Date().toISOString(),first_disp:new Date().toISOString(),ap_status:"s",status:"s",cust_draw:"string",revision_no:"strin",revision_date:new Date().toISOString(),sample_size:"string",consignment_size:"string",annu_req:0,surface_treat:"string",mat_spec:"string",sr_no:u+1,drg_rev_dt:new Date().toISOString(),profcen_cd:a,physibility_res:"string",mcAllowSurface:"string",forg_method:"string",gross_wt:0,input_wt:0,net_wt:0,wt_uom:"str",complex_factor:"string",forg_unit:"string",alt_forg_unit:"string",parting_line:"string",dia_bl_size:"string",op_seq:"string",prod_rate:"string",post_opns:"string",coining_det:"string",prod_rate_coining:"string",machine_Det:"string",stamp_logo_Det:"string",drawing_app:"str",forg_samp_req:"str",additoinal_rem:"string",apprx_lead_time:"string",disc_resolved:"string",parT_B_DT:new Date().toISOString(),parT_C_DT:new Date().toISOString(),disc_Partc:"string",disc_resolved_C:"string",avl_raw_mat:"string",part_no:"string",od:0,id:0,length:0,density:0,tollerence:0,item_Catg:"string",iTemcatg_uom:"strin",prodpo_no:"string",prodpo_dt:new Date().toISOString(),enq_uom:r.uom,fG_Catg:"st",application:r.application}))};try{p?(await updateEnquiryDetails(o),alert("Enquiry updated successfully!")):(await U(o),alert("Enquiry saved successfully!")),_({marketingBy:"",type:"",source:"",enquiryNo:"",date:"",customerCategory:"",customerCode:"",customerName:"",address:"",address1:"",cityName:"",pincode:"",country:"",state:"",telephone:"",email:"",industryType:"",designation:"",refDocDate:"",contactPerson:"",remark:"",customerPartNo:"",itemCode:"",itemName:"",quantity:"",uom:"",application:"",technicalFeasibility:""}),h([]),x([])}catch(r){alert(r.message||"Failed to save enquiry")}};return m.useEffect(()=>{if(!d)return;const a=d.Header_Data,o=d.Detail_Data||[];if(a){_(r=>({...r,enquiryNo:a.Enq_no??"",date:a.Enq_dt?a.Enq_dt.substring(0,10):"",marketingBy:a.Emp_name??"",type:a.Enq_type??"",source:a.source_name??"",customerCode:a.Cust_code??"",customerName:a.Cust_name??"",address:a.Cust_add1??"",address1:a.Cust_add2??"",cityName:a.Cust_city??"",state:a.Cust_state??"",country:a.Cust_country??"",pincode:a.Cust_pin??"",telephone:a.Phone??"",email:a.Email??"",industryType:a.Industry_name??"",designation:a.cont_des??"",refDocDate:a.Ref_dt?a.Ref_dt.substring(0,10):"",contactPerson:a.cont_per??"",remark:a.remarks??""}));debugger;h(o.map((r,u)=>({id:u+1,customerPartNo:r.Cust_item_code??"",itemCode:r.Item_Code??"",itemName:r.Item_name??"",quantity:r.Quantity??0,uom:r.enq_uom??"",application:r.Application??"",technicalFeasibility:r.Physibility??""})))}},[d]),e.jsxs(T,{maxWidth:"xl",children:[e.jsx(c,{className:"breadcrumb",mb:2,children:e.jsx(w,{routeSegments:[{name:"Sales"},{name:"Enquiry Detail"}]})}),e.jsxs(c,{sx:{background:"#fff",p:3,borderRadius:2},children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",mb:3,children:[e.jsx(c,{display:"flex",alignItems:"center",gap:1}),e.jsx(j,{variant:"contained",startIcon:e.jsx(E,{children:p?"update":"save"}),onClick:k,children:p?"Update":"Save"})]}),e.jsxs(c,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:2,children:[e.jsx(s,{label:"Marketing By",name:"marketingBy",value:t.marketingBy,onChange:i,size:"small"}),e.jsxs(s,{select:!0,label:"Type",name:"type",value:t.type,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"product",children:"Product"}),e.jsx(n,{value:"service",children:"Service"}),e.jsx(n,{value:"support",children:"Support"})]}),e.jsxs(s,{select:!0,label:"Source",name:"source",value:t.source,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"email",children:"Email"}),e.jsx(n,{value:"phone",children:"Phone"}),e.jsx(n,{value:"website",children:"Website"})]}),e.jsx(C,{control:e.jsx(S,{}),label:"Missing"}),e.jsxs(O,{children:[e.jsx(R,{children:"Customer"}),e.jsxs(F,{row:!0,value:q,onChange:a=>N(a.target.value),children:[e.jsx(C,{value:"existing",control:e.jsx(f,{size:"small"}),label:"Existing"}),e.jsx(C,{value:"new",control:e.jsx(f,{size:"small"}),label:"New"})]})]}),e.jsx(s,{label:"Enquiry No",name:"enquiryNo",value:t.enquiryNo,size:"small",InputProps:{readOnly:!0}}),e.jsx(s,{type:"date",label:"Date",name:"date",value:t.date,onChange:i,size:"small",InputLabelProps:{shrink:!0}}),e.jsxs(s,{select:!0,label:"Customer Category",name:"customerCategory",value:t.customerCategory,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"gold",children:"Gold"}),e.jsx(n,{value:"silver",children:"Silver"}),e.jsx(n,{value:"bronze",children:"Bronze"})]}),e.jsx(s,{label:"Customer Code",name:"customerCode",value:t.customerCode,onChange:i,size:"small"}),e.jsx(s,{label:"Customer Name",name:"customerName",value:t.customerName,onChange:i,size:"small"}),e.jsx(s,{label:"Address",name:"address",value:t.address,onChange:i,size:"small"}),e.jsx(s,{label:"Address 1",name:"address1",value:t.address1,onChange:i,size:"small"}),e.jsx(s,{label:"City Name",name:"cityName",value:t.cityName,onChange:i,size:"small"}),e.jsx(s,{label:"Pincode",name:"pincode",value:t.pincode,onChange:i,size:"small"}),e.jsxs(s,{select:!0,label:"Country",name:"country",value:t.country,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"india",children:"India"}),e.jsx(n,{value:"usa",children:"USA"}),e.jsx(n,{value:"uk",children:"UK"})]}),e.jsxs(s,{select:!0,label:"State",name:"state",value:t.state,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"maharashtra",children:"Maharashtra"}),e.jsx(n,{value:"karnataka",children:"Karnataka"}),e.jsx(n,{value:"delhi",children:"Delhi"})]}),e.jsx(s,{label:"Telephone",name:"telephone",value:t.telephone,onChange:i,size:"small"}),e.jsx(s,{label:"Email",name:"email",value:t.email,onChange:i,size:"small"}),e.jsxs(s,{select:!0,label:"Industry Type",name:"industryType",value:t.industryType,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"it",children:"IT"}),e.jsx(n,{value:"manufacturing",children:"Manufacturing"}),e.jsx(n,{value:"services",children:"Services"})]}),e.jsx(s,{label:"Designation",name:"designation",value:t.designation,onChange:i,size:"small"}),e.jsx(s,{type:"date",name:"refDocDate",label:"Ref. Document Dt",size:"small",value:t.refDocDate,onChange:i,InputLabelProps:{shrink:!0}}),e.jsx(s,{label:"Contact Person",name:"contactPerson",value:t.contactPerson,onChange:i,size:"small"}),e.jsx(s,{label:"Remark",name:"remark",value:t.remark,onChange:i,size:"small"}),e.jsx(s,{label:"Customer Part No",name:"customerPartNo",value:t.customerPartNo,onChange:i,size:"small"}),e.jsx(s,{label:"Item Code",name:"itemCode",value:t.itemCode,onChange:i,size:"small"}),e.jsx(s,{label:"Item Name",name:"itemName",value:t.itemName,onChange:i,size:"small"}),e.jsx(s,{label:"Quantity",name:"quantity",value:t.quantity,onChange:i,size:"small"}),e.jsxs(s,{select:!0,label:"UOM",name:"uom",value:t.uom,onChange:i,size:"small",children:[e.jsx(n,{value:"",children:"-- Select --"}),e.jsx(n,{value:"pcs",children:"PCS"}),e.jsx(n,{value:"kg",children:"KG"}),e.jsx(n,{value:"ltr",children:"LTR"})]}),e.jsx(s,{label:"Application",name:"application",value:t.application,onChange:i,size:"small"}),e.jsx(s,{label:"Technical Feasibility",name:"technicalFeasibility",value:t.technicalFeasibility,onChange:i,size:"small"})]}),e.jsxs(c,{display:"flex",justifyContent:"flex-end",gap:2,mt:3,children:[e.jsx(j,{variant:"contained",onClick:z,children:"Add Item"}),e.jsx(j,{variant:"contained",color:"error",onClick:D,disabled:y.length===0,children:"Remove"})]}),e.jsx(B,{children:e.jsxs(M,{size:"small",children:[e.jsx(A,{children:e.jsxs(v,{children:[e.jsx(l,{children:"Select"}),e.jsx(l,{children:"Customer Part No"}),e.jsx(l,{children:"Item Code"}),e.jsx(l,{children:"Item Name"}),e.jsx(l,{children:"Quantity"}),e.jsx(l,{children:"UOM"})]})}),e.jsx(L,{children:g.length>0?g.map(a=>e.jsxs(v,{children:[e.jsx(l,{children:e.jsx(S,{checked:y.includes(a.id),onChange:()=>I(a.id)})}),e.jsx(l,{children:a.customerPartNo}),e.jsx(l,{children:a.itemCode}),e.jsx(l,{children:a.itemName}),e.jsx(l,{children:a.quantity}),e.jsx(l,{children:a.uom})]},a.id)):e.jsx(v,{children:e.jsx(l,{colSpan:6,align:"center",children:"No items added"})})})]})})]})]})};export{Q as default};
