import{r as u,j as e,aL as W,aM as E,I as P,aS as F,aN as z,ab as q,ac as L,ad as g,ae as C,V as o,M as m,aO as M,n as y,U as Y,bk as G,bg as Q,B as d,q as U,w as v,L as V,F as H,H as S,J as s,K as J,af as K,S as X,bl as Z}from"./index-BDZEQFom.js";const $=({open:_,onClose:a,onSave:x})=>{const[i,b]=u.useState({transporterOn:"Our A/c",transporterCode:"",transportMode:"By Road",vehicleNo:"",packFwdAmt:"",ewayBillNo:""});u.useEffect(()=>{_&&b({transporterOn:"Our A/c",transporterCode:"",transportMode:"By Road",vehicleNo:"",packFwdAmt:"",ewayBillNo:""})},[_]);const p=l=>{const{name:j,value:h}=l.target;b({...i,[j]:h})},f=()=>{x(i),a()};return e.jsxs(W,{open:_,onClose:a,fullWidth:!0,maxWidth:!1,PaperProps:{sx:{width:800,maxWidth:800}},children:[e.jsxs(E,{children:["Transporter Details",e.jsx(P,{onClick:a,sx:{position:"absolute",right:10,top:10},children:e.jsx(F,{})})]}),e.jsx(z,{dividers:!0,children:e.jsxs(q,{spacing:3,children:[e.jsxs(L,{row:!0,name:"transporterOn",value:i.transporterOn,onChange:p,children:[e.jsx(g,{value:"Our A/c",control:e.jsx(C,{}),label:"Our A/c"}),e.jsx(g,{value:"Your A/c",control:e.jsx(C,{}),label:"Your A/c"}),e.jsx(g,{value:"N.A",control:e.jsx(C,{}),label:"N.A"})]}),e.jsx(o,{fullWidth:!0,size:"small",label:"Transporter Code",name:"transporterCode",value:i.transporterCode,onChange:p}),e.jsxs(o,{select:!0,fullWidth:!0,size:"small",label:"Transport Mode",name:"transportMode",value:i.transportMode,onChange:p,children:[e.jsx(m,{value:"By Road",children:"By Road"}),e.jsx(m,{value:"By Air",children:"By Air"}),e.jsx(m,{value:"By Rail",children:"By Rail"}),e.jsx(m,{value:"By Sea",children:"By Sea"})]}),e.jsx(o,{fullWidth:!0,size:"small",label:"Vehicle No",name:"vehicleNo",value:i.vehicleNo,onChange:p}),e.jsx(o,{fullWidth:!0,size:"small",label:"Pack Fwd Amt",name:"packFwdAmt",type:"number",value:i.packFwdAmt,onChange:p}),e.jsx(o,{fullWidth:!0,size:"small",label:"Eway Bill Number",name:"ewayBillNo",value:i.ewayBillNo,onChange:p})]})}),e.jsxs(M,{children:[e.jsx(y,{variant:"contained",onClick:f,children:"Save"}),e.jsx(y,{variant:"outlined",onClick:a,children:"Close"})]})]})},ae=()=>{const _=Y(),[a,x]=u.useState({packingType:"",subType:"",slipNo:"",date:"",customer:"",orderNo:"",remark:"",poNo:"",poDate:"",referGrn:!1,itemCode:"",operation:"",quantity:"",formNo:"",formDate:"",formType:"",currency:""}),[i,b]=u.useState([]),[p,f]=u.useState(!1),[l,j]=u.useState(null),[h,N]=u.useState([]),[k,D]=u.useState([]);u.useEffect(()=>{I()},[]);const I=async()=>{const n=await G();D(n)},r=n=>{const{name:c,value:t,type:A,checked:R}=n.target;x({...a,[c]:A==="checkbox"?R:t})},T=()=>{if(!a.itemCode||!a.quantity)return;const n={itemCode:a.itemCode,operation:a.operation,quantity:a.quantity,formNo:a.formNo,formDate:a.formDate,formType:a.formType,currency:a.currency};b([...i,n]),x({...a,itemCode:"",operation:"",quantity:"",formNo:"",formDate:"",formType:"",currency:""})},w=()=>{const n=i.filter((c,t)=>!h.includes(t));b(n),N([])},O=n=>{h.includes(n)?(N([]),x(t=>({...t,itemCode:""}))):(N([n]),x(t=>({...t,itemCode:i[n].itemCode})))},B=async n=>{n.preventDefault();const c={packingSlip_ex:{slip_No:a.slipNo,slip_dt:a.date,cust_Code:a.customer,po_Id:a.poNo,po_id_dt:a.poDate,emp_no:a.empNo,remark:a.remark,slip_type:a.packingType,profcen_cd:localStorage.getItem("PROFCEN_CD"),saleS_TYPE:a.subType,iS_REFERGIN:a.referGrn?"Y":"N",curR_CODE:a.currency||"INR",form_type:a.formType||"Invoice",form_no:a.formNo||"INV-001",form_date:a.formDate||new Date().toISOString(),transporteR_CODE:(l==null?void 0:l.transporterCode)||"",vehiclE_NO:(l==null?void 0:l.vehicleNo)||"",deleverY_BY:(l==null?void 0:l.transportMode)||"",transport:(l==null?void 0:l.transporterOn)||"",packFWD_amt:Number((l==null?void 0:l.packFwdAmt)||0),ewayBill_no:(l==null?void 0:l.ewayBillNo)||"",custMatAmt:0,trans_name:(l==null?void 0:l.transporterName)||"",uT1_no:a.ut1No||"",uT1_date:a.ut1Date||new Date().toISOString(),valid_date:a.validDate||new Date().toISOString(),discAmount:a.discount||0,app_by2:a.appBy2||"",app_date2:a.appDate2||new Date().toISOString(),user_name:"ADMIN",user_date:new Date().toISOString(),app_flag:a.appFlag||"Y",app_by:a.appBy||"",app_date:a.appDate||new Date().toISOString(),app_by1:a.appBy1||"",app_date1:a.appDate1||new Date().toISOString()},list_packingslip_detail_ex:i.map(t=>({slip_No:a.slipNo,slip_dt:a.date,item_code:t.itemCode,quantity:Number(t.quantity),emp_no:a.empNo||"",heat_code:t.heatCode||"",inv_no:t.invNo||"",inv_dt:t.invDate||new Date().toISOString(),slip_type:a.packingType,profcen_cd:localStorage.getItem("PROFCEN_CD"),amend_no:t.amendNo||"",amend_dt:t.amendDate||new Date().toISOString(),po_Id:a.poNo,po_id_dt:a.poDate,uL_LOCATION:t.ulLocation||"",remark:a.remark,wt:Number(t.weight||0),box_no:t.boxNo||"",man_Dt:t.manDate||new Date().toISOString(),exp_Dt:t.expDate||new Date().toISOString(),batchQty:Number(t.batchQty||0),batch_no:t.batchNo||"",burnt_per:Number(t.burntPer||0),wo_no:t.woNo||"",wo_date:t.woDate||new Date().toISOString(),cust_Ul_Location:t.custUlLocation||"",act_batchqty:Number(t.actBatchQty||0),box_uom:t.boxUom||"",layout_len:Number(t.layoutLen||0),stk_idnt:t.stockIdent||"",cust_item_desc:t.custItemDesc||"",pcust_code:t.pcustCode||"",packingrate:Number(t.packingRate||0),sW_flag:t.swFlag||"",part_full:t.partFull||"",mfG_rate:Number(t.mfgRate||0),pack_uom:t.packUom||""})),list_tag_details_ex:tags.map(t=>({slip_no:a.slipNo,slip_date:a.date,inv_no:t.invNo||"",inv_date:t.invDate||new Date().toISOString(),profcen_cd:localStorage.getItem("PROFCEN_CD"),srno:Number(t.srNo||0),packingtype:t.packingType||"",qty_per_pack:Number(t.qtyPerPack||0),packqty:Number(t.packQty||0),inV_TYPE:t.invType||"",saleS_TYPE:a.subType,item_code:t.itemCode||"",wt_per_box:Number(t.wtPerBox||0),sub_type:t.subType||"",subpackqty:Number(t.subPackQty||0),pack_remark:t.packRemark||"",ul_Location:t.ulLocation||"",cinv_no:t.cinvNo||"",cinv_Dt:t.cinvDate||new Date().toISOString(),po_id:a.poNo,tBox_no:t.tBoxNo||""}))};console.log("FINAL PAYLOAD:",c);try{const t=await Z(c);alert(t.Message),_("/material/packing-slip")}catch(t){console.error(t),alert(t.message)}};return e.jsxs(Q,{maxWidth:"xl",children:[e.jsx(d,{className:"breadcrumb",children:e.jsx(U,{routeSegments:[{name:"Transactions"},{name:"Packing Slip"}]})}),e.jsxs("form",{onSubmit:B,children:[e.jsx(d,{sx:{background:"#fff",padding:4},children:e.jsxs(d,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:3,children:[e.jsxs(o,{label:"Packing Type",name:"packingType",value:a.packingType,onChange:r,select:!0,size:"small",fullWidth:!0,children:[e.jsx(m,{value:"Domestic",children:"Domestic"}),e.jsx(m,{value:"Export",children:"Export"})]}),e.jsx(o,{label:"Sub Type",name:"subType",value:a.subType,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{label:"Slip No",name:"slipNo",value:a.slipNo,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{type:"date",label:"Date",name:"date",value:a.date,onChange:r,InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(o,{label:"Customer",name:"customer",value:a.customer,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{label:"Order No",name:"orderNo",value:a.orderNo,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{label:"P.O No",name:"poNo",value:a.poNo,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{type:"date",label:"P.O Date",name:"poDate",value:a.poDate,onChange:r,InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(o,{label:"Remark",name:"remark",value:a.remark,onChange:r,size:"small",rows:2,fullWidth:!0}),e.jsx(g,{control:e.jsx(v,{checked:a.referGrn,onChange:r,name:"referGrn"}),label:"Refer GRN"})]})}),e.jsx(d,{sx:{background:"#fff",padding:4,mb:-4,mt:-4,justifyContent:"flex-end",display:"flex"},children:e.jsxs(d,{display:"flex",gap:2,children:[e.jsx(y,{variant:"contained",onClick:T,children:"ADD"}),e.jsx(y,{variant:"contained",color:"error",disabled:h.length===0,onClick:w,children:"REMOVE"}),e.jsx(y,{variant:"contained",color:"secondary",onClick:()=>f(!0),children:"TRANSPORTER"})]})}),e.jsxs(d,{sx:{background:"#fff",padding:4},children:[e.jsxs(d,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:3,alignItems:"center",children:[e.jsxs(o,{size:"small",select:!0,fullWidth:!0,label:"Item Code",name:"itemCode",value:a.itemCode||"",onChange:r,children:[e.jsx(m,{value:"",children:"Select"}),k.map((n,c)=>e.jsxs(m,{value:n.ITEM_CODE,children:[n.ITEM_CODE," - ",n.CATG_CODE]},c))]}),e.jsx(o,{label:"Operation",name:"operation",value:a.operation,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{label:"Quantity",name:"quantity",type:"number",value:a.quantity,onChange:r,fullWidth:!0,size:"small"})]}),e.jsxs(d,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:3,mt:4,children:[e.jsx(o,{label:"Form No",name:"formNo",value:a.formNo,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{type:"date",label:"Form Date",name:"formDate",value:a.formDate,onChange:r,InputLabelProps:{shrink:!0},fullWidth:!0,size:"small"}),e.jsx(o,{label:"Form Type",name:"formType",value:a.formType,onChange:r,fullWidth:!0,size:"small"}),e.jsx(o,{label:"Currency",name:"currency",value:a.currency,onChange:r,fullWidth:!0,size:"small"})]}),i.length>0&&e.jsx(d,{mt:4,children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(S,{children:[e.jsx(s,{padding:"checkbox"}),e.jsx(s,{children:"Item Code"}),e.jsx(s,{children:"Operation"}),e.jsx(s,{children:"Quantity"}),e.jsx(s,{children:"Form No"}),e.jsx(s,{children:"Form Date"}),e.jsx(s,{children:"Form Type"}),e.jsx(s,{children:"Currency"})]})}),e.jsx(J,{children:i.map((n,c)=>e.jsxs(S,{selected:h.includes(c),children:[e.jsx(s,{padding:"checkbox",children:e.jsx(v,{checked:h.includes(c),onChange:()=>O(c)})}),e.jsx(s,{children:n.itemCode}),e.jsx(s,{children:n.operation}),e.jsx(s,{children:n.quantity}),e.jsx(s,{children:n.formNo}),e.jsx(s,{children:n.formDate}),e.jsx(s,{children:n.formType}),e.jsx(s,{children:n.currency})]},c))})]})}),e.jsx(d,{mt:4,textAlign:"right",children:e.jsx(y,{type:"submit",variant:"contained",startIcon:e.jsx(K,{children:"save"}),children:e.jsx(X,{children:"Save"})})})]})]}),e.jsx($,{open:p,onClose:()=>f(!1),onSave:n=>j(n)})]})};export{ae as default};
